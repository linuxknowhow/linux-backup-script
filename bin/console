#!/usr/bin/env php
<?php

require dirname(__FILE__) . '/../src/init.php';
require dirname(__FILE__) . '/../src/functions.php';

use Backup\Config;
use Backup\BackupController;

$config = new Config();

$backup_controller = new BackupController($config);

$options = getopt('', ['create::', 'extract::', 'cleanup::']);

$scriptName = basename(__FILE__);

if (empty($options)) {
    echo 'Action is not specified. Please add at least one action:' . PHP_EOL;
    echo $scriptName . ' --create  - create and upload backup' . PHP_EOL;
    echo $scriptName . ' --extract - extract files from a backup' . PHP_EOL;
    echo $scriptName . ' --cleanup - delete expired backups' . PHP_EOL;
}

foreach ($options as $action => $value) {
    switch ($action) {
        case 'create':
            $backup_controller->createAction();
            break;

        case 'extract':
            $backup_controller->extractAction();
            break;

        case 'cleanup':
            $backup_controller->cleanupAction();
            break;
    }
}
